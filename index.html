<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, viewport-fit=cover"
        />

        <title>Valentine Letter</title>

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap"
            rel="stylesheet"
        />

        <style>
            /* MOBILE SAFE VIEWPORT FIX */
            body {
                margin: 0;
                height: 100dvh; /* fixes mobile vh bug */
                display: flex;
                justify-content: center;
                align-items: center;
                background-image: url("heart-bg.jpg");
                background-size: cover;
                background-position: center;
                font-family: "Pixelify Sans", sans-serif;
                overflow: hidden;
            }

            /* Envelope */

            #envelope-container {
                text-align: center;
                cursor: pointer;
                padding: 20px;
            }

            #envelope {
                width: min(200px, 60vw);
                animation: pulse 1.5s infinite;
            }

            @keyframes pulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                }
            }

            /* Letter */

            #letter-container {
                display: none;
                position: fixed;
                inset: 0;
                justify-content: center;
                align-items: center;
                padding: 10px;
            }

            .letter-window {
                width: 95vw;
                max-width: 800px;
                aspect-ratio: 3/2;

                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                text-align: center;

                background-image: url("window.png");
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;

                padding-top: 160px;

                transform: scale(1.2);
                opacity: 0;

                transition: all 0.6s ease;
            }

            .letter-window.open {
                transform: scale(1);
                opacity: 1;
            }

            /* Text */

            h1 {
                font-size: clamp(20px, 5vw, 30px);
            }

            p {
                font-size: clamp(18px, 5vw, 40px);
            }

            /* Cat */

            .cat {
                width: min(250px, 60vw);
            }

            /* Buttons */

            .buttons {
                display: flex;
                gap: 20px;
            }

            .btn {
                width: min(120px, 28vw);
                user-select: none;
                touch-action: manipulation;
            }

            .final-text {
                font-size: 22px;
            }
        </style>
    </head>

    <body>
        <audio id="bgm" loop>
            <source src="val.mp3" type="audio/mpeg" />
        </audio>

        <div id="envelope-container">
            <img src="envelope.png" id="envelope" />

            <p>A Letter For My Pretty Girl üôÉ</p>
        </div>

        <div id="letter-container">
            <div class="letter-window">
                <h1 id="letter-title">
                    Will you be my Valentine Pretty Girl üòè?
                </h1>

                <img src="cat_heart.gif" class="cat" id="letter-cat" />

                <div class="buttons" id="letter-buttons">
                    <img src="yes.png" class="btn yes-btn" />

                    <img src="no.png" class="btn no-btn" />
                </div>
            </div>
        </div>

        <script>
            /* ELEMENTS */

            const envelope = document.getElementById("envelope-container");
            const letter = document.getElementById("letter-container");

            const noBtn = document.querySelector(".no-btn");
            const yesBtn = document.querySelector(".yes-btn");

            const title = document.getElementById("letter-title");
            const catImg = document.getElementById("letter-cat");
            const buttons = document.getElementById("letter-buttons");

            const audio = document.getElementById("bgm");

            let started = false;

            /* START AUDIO ON FIRST TOUCH */

            function startExperience() {
                if (started) return;
                started = true;

                audio.volume = 0;

                audio.play().then(() => {
                    let vol = 0;

                    const fade = setInterval(() => {
                        if (vol < 0.8) {
                            vol += 0.02;
                            audio.volume = vol;
                        } else {
                            clearInterval(fade);
                        }
                    }, 100);
                });
            }

            /* UNIVERSAL TOUCH + CLICK SUPPORT */

            document.addEventListener("pointerdown", startExperience, {
                once: true,
            });

            /* HEART BURST */

            function heartBurst() {
                for (let i = 0; i < 120; i++) {
                    const h = document.createElement("div");

                    h.textContent = "üíñ";

                    h.style.position = "fixed";
                    h.style.left = "50%";
                    h.style.top = "50%";
                    h.style.fontSize = "22px";
                    h.style.pointerEvents = "none";

                    document.body.appendChild(h);

                    const angle = Math.random() * Math.PI * 2;
                    const distance = 140 + Math.random() * 500;

                    h.animate(
                        [
                            { transform: "translate(-50%,-50%)", opacity: 1 },

                            {
                                transform: `translate(${Math.cos(angle) * distance}px,${Math.sin(angle) * distance}px)`,
                                opacity: 0,
                            },
                        ],
                        {
                            duration: 1400,
                            easing: "ease-out",
                        },
                    );

                    setTimeout(() => h.remove(), 1400);
                }
            }

            document.addEventListener("DOMContentLoaded", () => {
                heartBurst();

                startFloatingHearts();
            });

            /* CONTINUOUS FLOATING HEARTS BACKGROUND */

            function startFloatingHearts() {
                setInterval(() => {
                    const h = document.createElement("div");

                    h.textContent = "üíó";

                    h.style.position = "fixed";

                    h.style.left = Math.random() * 100 + "vw";

                    h.style.bottom = "-30px";

                    h.style.fontSize = 16 + Math.random() * 24 + "px";

                    h.style.opacity = Math.random();

                    h.style.pointerEvents = "none";

                    h.style.zIndex = "0";

                    document.body.appendChild(h);

                    const duration = 4000 + Math.random() * 4000;

                    h.animate(
                        [
                            {
                                transform: "translateY(0)",
                                opacity: h.style.opacity,
                            },

                            { transform: `translateY(-110vh)`, opacity: 0 },
                        ],
                        {
                            duration: duration,

                            easing: "linear",
                        },
                    );

                    setTimeout(() => h.remove(), duration);
                }, 300);
            }

            /* OPEN LETTER */

            envelope.addEventListener("pointerdown", () => {
                envelope.style.display = "none";

                letter.style.display = "flex";

                setTimeout(() => {
                    document
                        .querySelector(".letter-window")
                        .classList.add("open");
                }, 50);
            });

            /* MOVE NO BUTTON ‚Äî TOUCH + MOUSE */

            function moveNoButton() {
                const distance = 180;
                const angle = Math.random() * Math.PI * 2;

                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;

                noBtn.style.transform = `translate(${x}px,${y}px)`;
            }

            /* support mouse AND touch */

            noBtn.addEventListener("pointerenter", moveNoButton);
            noBtn.addEventListener("pointerdown", moveNoButton);

            /* YES CLICK */

            yesBtn.addEventListener("pointerdown", () => {
                title.textContent = "Yyyaaaayyyy!!üòç I Love You Soooo Much";

                catImg.src = "cat_dance.gif";

                catImg.style.transform = "translateY(-15px)"; // move up slightly

                buttons.style.display = "none";

                heartBurst();
            });
        </script>
    </body>
</html>
